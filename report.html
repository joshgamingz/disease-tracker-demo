<html>
<head>
    <link rel="stylesheet" href="style.css">
    <title>Submit Case Report</title>
    <style>
        /* Updated fonts to match Home.html content */
        body {
            background-color: #0a192f;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #F0F0F0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
        }

        #report-form {
            background-color: #172a46;
            border-radius: 10px;
            padding: 2.5rem;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 217, 0, 0.2);
            margin-top: 100px;
        }

        #report-form h3 { color: #FFD900; text-align: center; margin-bottom: 20px;}
        #report-form label { display: block; margin-top: 1rem; color: #ccd6f6; }

        #report-form input, #report-form select {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            border: 1px solid #304a6e;
            border-radius: 5px;
            background-color: #0a192f;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #report-form button {
            width: 100%;
            padding: 14px;
            margin-top: 2rem;
            background-color: #FFD900;
            color: #172a46;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        #report-form button:hover { background-color: #ffee7a; }

        .navigation { top: 30px; }
    </style>
</head>

<body>
<!-- Nav -->
<div class="navigation">
    <nav>
        <ul class="nav-type">
            <li><a href="home.html">Home</a></li>
            <li><a href="index.html">Map</a></li>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="report.html" class="active2">Forms</a></li>
            <li><a href="education.html">Education</a></li>
        </ul>
    </nav>
</div>

<form id="report-form">
    <h3>Update District Data *FOR DATA MANAGER ACCESS ONLY*</h3>

    <label>City:</label>
    <select id="city-select" onchange="updateDistricts()">
        <option value="Quezon City">Quezon City</option>
        <option value="Manila">Manila</option>
    </select>

    <label>District:</label>
    <select id="district-select">
        <!-- Options populated by JS -->
    </select>

    <label>Disease:</label>
    <select id="disease">
        <option value="dengue">Dengue</option>
        <option value="lepto">Leptospirosis</option>
        <option value="influenza">Influenza</option>
    </select>

    <label>Number of Cases (Active):</label>
    <input type="number" id="cases" min="0" placeholder="e.g. 15" required>

    <button type="submit">Update Data</button>
</form>

<script>
    // District Logic
    function updateDistricts() {
        const city = document.getElementById('city-select').value;
        const districtSelect = document.getElementById('district-select');
        districtSelect.innerHTML = ""; // Clear existing

        // Create 6 districts
        for(let i=1; i<=6; i++) {
            let opt = document.createElement('option');
            if(city === "Quezon City") {
                opt.value = "d" + i; // matches JSON id: d1, d2...
                opt.innerHTML = "District " + i;
            } else {
                opt.value = "mnld" + i; // matches JSON id: mnld1, mnld2...
                opt.innerHTML = "District " + i;
            }
            districtSelect.appendChild(opt);
        }
    }

    // Run once on load
    updateDistricts();

    // Submit Logic
    const form = document.getElementById('report-form');

    form.addEventListener('submit', (e) => {
        e.preventDefault();

        const city = document.getElementById('city-select').value;
        const districtId = document.getElementById('district-select').value;
        const disease = document.getElementById('disease').value;
        const cases = parseInt(document.getElementById('cases').value);

        // Send to our local Node.js server
        fetch('http://localhost:3000/update-case', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                id: districtId,
                disease: disease,
                count: cases
            })
        })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    alert(`SUCCESS! Data updated in JSON file.\n\n${city} (${districtId})\n${disease}: ${cases}`);
                    form.reset();
                    updateDistricts();
                } else {
                    alert("Error updating data.");
                }
            })
            .catch(err => {
                console.error(err);
                alert("Could not connect to server. Make sure you ran 'node server.js'");
            });
    });
</script>
</body>
</html>